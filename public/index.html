<!DOCTYPE html>
<html>

<head>
  <title>Projektet - Vejr & Klima</title>
  <h2 id="stor-overskrift">Projekt - Visualisering af vejr og Klima</h2>
  <script src="d3.js"></script>
  <link rel="stylesheet" href="styles.css" />
  <!-- Initialize a select button -->
  <select id="selectButton"></select>

  <!-- Create a div where the graph will take place -->
  <div id="dataviz"></div>
</head>

<body>
  <section id="section1">
    <script>
      // set the dimensions and margins of the graph
      const margin = { top: 10, right: 100, bottom: 30, left: 30 },
        width = 800 - margin.left - margin.right,
        height = 600 - margin.top - margin.bottom;

      // append the svg object to the body of the page
      const svg = d3
        .select("#dataviz")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

      //Read the data
      d3.json("/api/energyEntities", {
        method: "POST",
      }).then(function (response) {
        const data = response.data; // Hent data ud af response
        console.log("data", data);

        // add the options to the button
        d3.select("#selectButton")
          .selectAll("myOptions")
          .data(data)
          .enter()
          .append("option")
          .text((d) => d.entity) // text showed in the menu
          .attr("Value", d => d); // corresponding value returned by the button
      });

      /*d3.json("/api/energyYear", {
        method: "POST",
      }).then(function (response) {
        const data = response.data; // Hent data ud af response
          console.log("data", data);*/

      d3.json("/api/energyData", {
        method: "POST",
      }).then(function (response) {
        const data = response.data; // Hent data ud af response
        console.log("data", data);
        console.log(response);

        function parsefloat(d) {
          for (let i = 0; i < data.length; i++) {
            parsefloat(d.primary_energy_consum)
            return d.primary_energy_consum;
            console.log(d.primary_energy_consum);
          }
        }

        // Add X axis
        const x = d3
          .scaleLinear()
          .domain([d3.min(data, d => d.year), d3.max(data, d => d.year)])
          .range([0, width]);
        svg
          .append("g")
          .attr("transform", `translate(0, ${height})`)
          .call(d3.axisBottom(x));

        // Just in case der opstÃ¥r behov for det: d3.timeParse(%Y)

        // Add Y axis
        const y = d3
          .scaleLinear()
          .domain([d3.min(data, d => d.primary_energy_consum), d3.max(data, d => d.primary_energy_consum)])
          .range([height, 0])
        svg.append("g").call(d3.axisLeft(y));

        // Initialize line with group a
        const line = svg
          .append("g")
          .append("path")
          .datum(data)
          .attr(d3.line()
            .x(data, d => x(d.year))
            .y(data, d => y(d.primary_energy_consum))
          );

        // Dots
        const dot = svg
          .selectAll("circle")
          .data(data)
          .join("circle")
          .attr("cx", data, (d) => x(d.year))
          .attr("cy", data, (d) => y(d.primary_energy_consum))
          .attr("r", 5)
          .style("fill", "#69b3a2");
        /*
                // A function that update the chart
                function update(entity, year, primary_energy_consum) {
                  // Create new data with the selection?
                  const dataFilter = data.map(function (d) {
                    return { country: d[entity], time: d[year], value: d[primary_energy_consum]};
                  });
        
                  // Give these new data to update line
                  line
                    .datum(dataFilter)
                    .transition()
                    .duration(1000)
                    .attr("data", d3.line()
                      .x(d => x(d.year))
                      .y(d => y(d.primary_energy_consum))
                    );
        
                  dot
                    .data(dataFilter)
                    .transition()
                    .duration(1000)
                    .attr("cx", (d => d.year))
                    .attr("cy", (d => d.primary_energy_consum));
                }
        
                // When the button is changed, run the updateChart function
                d3.select("#selectButton").on("change", function (event, d) {
                  // recover the option that has been chosen
                  let selectedOption = d3.select(this)
                    .property("primary_energy_consum", "entity", "year")
                  // run the updateChart function with this selected option
                  update(selectedOption);
                });*/
      });
    </script>
  </section>
  <br>
  <section id="section2">
    <h1>Hej</h1>
  </section>
</body>

</html>