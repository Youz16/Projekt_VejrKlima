<!DOCTYPE html>
<html>

<head>
  <title>Projektet - Vejr & Klima</title>
  <h2 id="stor-overskrift">Projekt - Visualisering af vejr og Klima</h2>
  <script src="d3.js"></script>
  <link rel="stylesheet" href="styles.css" />
  <!-- Initialize a select button -->
  <select id="selectButton"></select>

  <!-- Create a div where the graph will take place -->
  <div id="dataviz"></div>
</head>

<body>
  <section id="section1">
    <script>
      // set the dimensions and margins of the graph
      const margin = { top: 10, right: 100, bottom: 30, left: 60 },
        width = 800 - margin.left - margin.right,
        height = 700 - margin.top - margin.bottom;
      const padding = 10;
      // append the svg object to the body of the page
      const svg = d3
        .select("#dataviz")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

      //Read the data
      d3.json("/api/energyEntities", {
        method: "POST",
      }).then(function (response) {
        const data = response.data; // Hent data ud af response
        console.log("data", data);

        // add the options to the button
        d3.select("#selectButton")
          .selectAll("myOptions")
          .data(data)
          .enter()
          .append("option")
          .text((d) => d.entity) // text showed in the menu
          .attr("Value", d => d.entity); // corresponding value returned by the button
      });


      // Getting the value of the select element
      d3.select("#selectButton")
        .on("change", function onchangeHandler(event) {
          d3.select(".yAxis")
            .remove()
            .transition()
            .duration(1500)
            .ease(d3.easeCircleIn);
          d3.select(".xAxis")
            .remove()
            .transition()
            .duration(1500)
            .ease(d3.easeCircleIn);
          d3.select(".line")
            .remove()
            .append("path")
            .transition()
            .duration(1500)
            .ease(d3.easeCircleIn);

          event = document.getElementById("selectButton").value;
          console.log(event);


          // Reading the data using the value of the select element as a parameter
          d3.json("/api/energyData/" + event, {
            method: "POST",
          }).then(function (response) {
            const data = response.data; // Hent data ud af response
            console.log("data", data);
            console.log(response);

            const formatTime = d3.timeParse("%Y")

            // Add X axis
            const x = d3
              .scaleLinear()
              .domain([d3.min(data, d => d.year), d3.max(data, d => d.year)])
              .range([0, width]);
            svg
              .append("g")
              .attr("transform", `translate(0, ${height})`)
              .attr("class", "xAxis")
              .call(d3.axisBottom(x));

            // Just in case der opstÃ¥r behov for det: d3.timeParse(%Y)

            // Add Y axis
            const y = d3
              .scaleLinear()
              .domain([0, d3.max(data, d => +d.primary_energy_consum)])
              .range([height, 0])
            svg
              .append("g")
              .attr("class", "yAxis")
              .call(d3.axisLeft(y))
              // Add titles to the y axis
              .append("text")
              .attr("class", "yAxis_label")
              .text("TWh")
              .attr("text-anchor", "middle")
              .attr("transform", "translate(" + (padding - margin.left) + "," + (height / 2) + ")rotate(-90)")  // text is drawn off the screen top left, move down and out and rotate
              .attr("color", "black");

            // Initialize line
            const line = d3.line()
              .defined(function (d) { return d.primary_energy_consum >= 0; })
              .x(function (d) { return x(d.year); })
              .y(function (d) { return y(d.primary_energy_consum); });
            svg
              .append("g")
              .append("path")
              .datum(data)
              .attr("class", "line")
              .attr("d", line)
              .style("fill", "none")
              .style("stroke", "black")
              .style("stroke-width", 3);

            // Dots
            const dot = svg
              .selectAll("circle")
              .data(data)
              .join("circle")
              .attr("cx", d => x(d.year))
              .attr("cy", d => y(d.primary_energy_consum))
              .attr("r", 5)
              .style("fill", "#69b3a2");
          });
        });
    </script>
  </section>
  <br>
  <section id="section2">
    <h1>Datageeks don't exi-</h1>
  </section>
</body>

</html>